<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sakila : ë„ì‹œ ê´€ë¦¬</title>
<!-- ìŠ¤íƒ€ì¼ì‹œíŠ¸ css íŒŒì¼ import -->
<link rel="stylesheet" href="../style/hi.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>
<body>
	<div class="columns" style="margin:0; height: 100%">
		<!-- ë©”ë‰´ -->
		<div class="column is-2 notification card is-peachy" style="margin:0;">
			<section class="section">
			    <div id="menu"></div>
			</section>
		</div>
		<!-- ë‚´ìš© -->
		<div class="column">
			 <nav class="breadcrumb notification is-lighter-peachy" aria-label="breadcrumbs">
			  <ul>
			    <li><a href="#">ADDRESS</a></li>
			    <li class="is-active"><a href="#" aria-current="page">ë„ì‹œê´€ë¦¬</a></li>
			  </ul>
			 </nav>
			 
			<section class="is-content">
		   	 	<h1 class="title is-4 is-spaced">ğŸŒ‡ ë„ì‹œ ê´€ë¦¬</h1>
				<h1 class="subtitle is-6">ë„ì‹œ ì„ íƒì§€ ì¶”ê°€</h1>
				<div>
					<!-- êµ­ê°€ ì„ íƒ -->
					êµ­ê°€<br>
					<div class="select">
						<select id="countryList"></select>
					</div>
					<!-- ì •ë³´ ì…ë ¥ -->
					<input type="text" id="countryId" readonly style="display:none"><br><br>
					ë„ì‹œëª… <input type="text" class="input tile is-3" id="city"><br>
					<button type="button" class="button is-light is-rounded is-danger tile is-2" id="addCity"> ë„ì‹œì¶”ê°€ </button>
				</div>
				<hr>
				<h2 class="title is-5 has-text-centered">ë„ì‹œ ëª©ë¡</h2>
				<table class="table is-fullwidth is-bordered is-hoverable">
					<thead>
					<tr>
						<th>ë“±ë¡ë²ˆí˜¸</th>
						<th>ë„ì‹œëª…</th>
						<th>ë§ˆì§€ë§‰ ìˆ˜ì •</th>
						<th>êµ­ê°€ë²ˆí˜¸</th>
						<th>êµ­ê°€ëª…</th>
						<th>êµ­ê°€ ìˆ˜ì •ì¼</th>
						</tr>
					</thead>
					<tbody id="list">
					</tbody>
				</table>
				<button type="button" class="button" id="preBtn">ì´ì „</button>
				<button type="button" class="button" id="nextBtn">ë‹¤ìŒ</button>
			</section>
			<div id="foot"></div>
		</div>
	</div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="../js/sakilaCRM.js"></script>
<script>
 
	let currentPage = 1;	
	$("#list").empty();
	// ì²˜ìŒ í˜ì´ì§€ ì—´ì—ˆì„ ë•Œ ëª©ë¡ ì¶œë ¥
	$.ajax({
		url: "/sakila/address/SelectCityList",
		method: "POST",
		data : { currentPage : currentPage},
		success : function(json){
			console.log(json);
			for(let i =0; i < json.length; i++){
			let html = "<tr>";
			html += "<td>"+json[i].cityId+"</td>";
			html += "<td>"+json[i].city+"</td>";
			html += "<td>"+json[i].lastUpdate+"</td>";
			html += "<td>"+json[i].country.countryId+"</td>";
			html += "<td>"+json[i].country.country+"</td>";
			html += "<td>"+json[i].country.lastUpdate+"</td>";
			html += "</tr>";
			$("#list").append(html);
			}									
		}
	});				
	//ì´ì „ ë²„íŠ¼
	$("#preBtn").click(function(){
		if(currentPage === 1){
			alert(" í˜„ì¬ 1í˜ì´ì§€ ì…ë‹ˆë‹¤. ë” ì´ìƒ ì•ìœ¼ë¡œ ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
			return;
		}
		currentPage -=1;
		console.log(currentPage);
		
		$("#list").empty();
		// ëª©ë¡ ì¶œë ¥
		$.ajax({
			url: "/sakila/address/SelectCityList",
			method: "POST",
			data : { currentPage : currentPage},
			success : function(json){
				console.log(json);
				for(let i =0; i < json.length; i++){
				let html = "<tr>";
				html += "<td>"+json[i].cityId+"</td>";
				html += "<td>"+json[i].city+"</td>";
				html += "<td>"+json[i].lastUpdate+"</td>";
				html += "<td>"+json[i].country.countryId+"</td>";
				html += "<td>"+json[i].country.country+"</td>";
				html += "<td>"+json[i].country.lastUpdate+"</td>";
				html += "</tr>";
				$("#list").append(html);
				}										
			}
		});		
	});
	
	// ë‹¤ìŒ ë²„íŠ¼
	$("#nextBtn").click(function(){
		let count = 0;
		$.ajax({
			url : "/sakila/address/SelectCityCount",
			method : "POST",
			async : false,
			success : function(json){
				console.log(json);
				count = Number(json);
			}
		});
		
		let lastPage = Math.ceil(count / 10);
		if(currentPage == lastPage){
			alert(" í˜„ì¬ ë§ˆì§€ë§‰í˜ì´ì§€ ì…ë‹ˆë‹¤. ë” ì´ìƒ ë‹¤ìŒìœ¼ë¡œ ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
			return;
		}
		
		currentPage +=1;
		console.log(currentPage);
		
		$("#list").empty();
		// ëª©ë¡ ì¶œë ¥
		$.ajax({
			url: "/sakila/address/SelectCityList",
			method: "POST",
			data : { currentPage : currentPage},
			success : function(json){
				console.log(json);
				for(let i =0; i < json.length; i++){
				let html = "<tr>";
				html += "<td>"+json[i].cityId+"</td>";
				html += "<td>"+json[i].city+"</td>";
				html += "<td>"+json[i].lastUpdate+"</td>";
				html += "<td>"+json[i].country.countryId+"</td>";
				html += "<td>"+json[i].country.country+"</td>";
				html += "<td>"+json[i].country.lastUpdate+"</td>";
				html += "</tr>";
				$("#list").append(html);
				}					
			}
		});		
	});
	
	$.ajax({
		url:"/sakila/address/SelectCountryListAll",
		method: "POST",
		success: function(json){
			console.log(json);
			$("#countryList").empty();
			for(let c of json){
				$("#countryList").append("<option value = '"+c.countryId+"'>"+c.country+"</option>");
			}
		}
	});
	
	// ë‚˜ë¼ ì„ íƒì‹œ ë‚˜ë¼ ë²ˆí˜¸ ì¶œë ¥ countryListì— ë³€í™”ê°€ ìƒê¸°ë©´
	$("#countryList").change(function(){
		$("#countryId").val($("#countryList").val());	// countryIdê°’ì´ ìˆì„ ì¥ì†Œì— countryListì˜ ê°’ì„ ë„£ëŠ”ë‹¤.
	});
	
	$("#addCity").click(function(){
		console.log("addCity ë²„íŠ¼ clicked"); 
		currentPage = 1;
		if($("#countryId").val() === "" || $("#city").val() === ""){
			alert("ê³µë°±ì„ ì±„ì›Œì£¼ì„¸ìš” !");
		}else{					
			$.ajax({
				url: "/sakila/address/InsertCity",
				method: "POST", 
				data: {countryId:$("#countryId").val(), city: $("#city").val()},
				success: function(json){
					console.log("ë ˆê³ ë ˆê³ ~");
					console.log("countryId: "+$("#countryId").val()+"city: "+$("#city").val());
					//ë¹„ìš°ê³ 
					$("#list").empty();
					// ëª©ë¡ ì¶œë ¥
					$.ajax({
						url: "/sakila/address/SelectCityList",
						method: "POST",
						data : { currentPage : currentPage},
						success : function(json){
							console.log(json);
							for(let i =0; i < json.length; i++){
								let html = "<tr>";
								html += "<td>"+json[i].cityId+"</td>";
								html += "<td>"+json[i].city+"</td>";
								html += "<td>"+json[i].lastUpdate+"</td>";
								html += "<td>"+json[i].country.countryId+"</td>";
								html += "<td>"+json[i].country.country+"</td>";
								html += "<td>"+json[i].country.lastUpdate+"</td>";
								html += "</tr>";
								$("#list").append(html);
							}//for end					
						} //success end
					});	//ajax end	
				},//success end
			});	// ajax end		
		}//else end
	});//click end
	 
</script>
</html>