<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sakila : ë„ì‹œ ê´€ë¦¬</title>
<!-- ìŠ¤íƒ€ì¼ì‹œíŠ¸ css íŒŒì¼ import -->
<link rel="stylesheet" href="../style/hi.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>
<body>
	<div class="columns" style="margin:0; height: 100%">
		<!-- ë©”ë‰´ -->
		<div class="column is-2 notification card is-peachy" style="margin:0;">
			<section class="section">
			    <component v-bind:is="testCompo"></component>
			</section>
		</div>
		<!-- ë‚´ìš© -->
		<div class="column">
			 <nav class="breadcrumb notification is-lighter-peachy" aria-label="breadcrumbs">
			  <ul>
			    <li><a href="#">ADDRESS</a></li>
			    <li class="is-active"><a href="#" aria-current="page">ë„ì‹œê´€ë¦¬</a></li>
			  </ul>
			 </nav>
			 
			<section class="is-content">
		   	 	<h1 class="title is-4 is-spaced">ğŸŒ‡ ë„ì‹œ ê´€ë¦¬</h1>
				<h1 class="subtitle is-6">ë„ì‹œ ì„ íƒì§€ ì¶”ê°€</h1>
				<div>
					<!-- êµ­ê°€ ì„ íƒ -->
					êµ­ê°€<br>
					<div class="select">
						<select id="countryList" v-model="countryId">
							<option selected value="0">ì¶”ê°€í•  ë„ì‹œì˜ êµ­ê°€ ì„ íƒ </option>
							<option v-for="item in country" :value="item.countryId">{{ item.country }}</option>
						</select>
					</div>
					<br>
					<!-- ì •ë³´ ì…ë ¥ --> 
					ë„ì‹œëª…<br>
					 <input type="text" class="input tile is-3" v-model="cityName"><br>
					<button type="button" class="button is-light is-rounded is-danger tile is-2" @click="addCity"> ë„ì‹œì¶”ê°€ </button>
				</div>
				<hr>
				<h2 class="title is-5 has-text-centered">ë„ì‹œ ëª©ë¡</h2>
				<table class="table is-fullwidth is-bordered is-hoverable">
					<thead>
					<tr>
						<th>ë“±ë¡ë²ˆí˜¸</th>
						<th>ë„ì‹œëª…</th>
						<th>ë§ˆì§€ë§‰ ìˆ˜ì •</th>
						<th>êµ­ê°€ë²ˆí˜¸</th>
						<th>êµ­ê°€ëª…</th>
						<th>êµ­ê°€ ìˆ˜ì •ì¼</th>
						</tr>
					</thead>
					<tbody>
						<tr v-for="item in json">
							<td>{{ item.cityId }}</td>
							<td>{{ item.city }}</td>
							<td>{{ item.lastUpdate }}</td>
							<td>{{ item.country.countryId }}</td>
							<td>{{ item.country.country }}</td>
							<td>{{ item.lastUpdate }}</td>
						</tr>
					</tbody>
				</table>
				<button type="button" class="button" id="preBtn">ì´ì „</button>
				<button type="button" class="button" id="nextBtn">ë‹¤ìŒ</button>
			</section>
			<component :is="footer"></component>
		</div>
	</div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="../js/sakilaCRM.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
var currentPage = 1;
var lastPage = 0;

var vm = new Vue({
	el: ".columns",
	data: {
		json:[{}],
		country : [{}], 
		countryId : 0,
		cityName : "",
		testCompo: Menu,
		footer : Footer,
	},
	mounted() {
		console.log("getting Info! ");
		console.log("get city Count");
		// city count | lastPage
		$.ajax({
			url : "/sakila/address/SelectCityCount",
			method : "POST",
			async : false,
			success : function(json){
				lastPage = (json%10!=0) ? parseInt(json/10)+1 : parseInt(json/10);
				console.log(lastPage);
			}
		}); 

		// country ëª©ë¡ ì¶œë ¥
		$.ajax({
			url:"/sakila/address/SelectCountryListAll", 
			method: "POST",
			success : function(json){
				vm.country = json; 
				console.log("vm.country", vm.country);
			}
		});	
		// city ëª©ë¡ ì¶œë ¥ 
		getCitylist();
	},
	methods: {  
		addCity : function(){
			console.log("vm.cityName: ", vm.cityName);
			console.log("vm.countryId: ", vm.countryId);
			$.ajax({
				url:"/sakila/address/InsertCity", 
				method: "POST",
				data : {countryId : vm.countryId, city : vm.cityName},
				async : false,
				success : function(json){
					alert("ì¶”ê°€ì™„ë£Œ");
				}
			});	
			getCitylist();
		},
		nextBtn : function(){
			if(currentPage >= lastPage){
				alert("ë§ˆì§€ë§‰ í˜ì´ì§€ì…ë‹ˆë‹¤.")
				return;
			}
			currentPage ++;
			getCitylist();
		},
		prevBtn : function(){
			if(currentPage <= 1){
				alert("ì²« í˜ì´ì§€ ì…ë‹ˆë‹¤.")
				return;
			}
			currentPage --;
			getCitylist();
		},
	},
});

function getCitylist(){
	$.ajax({
		url: "/sakila/address/SelectCityList",
		method: "POST",
		data : { currentPage : currentPage},
		success : function(json){
			console.log(json);
			vm.json = json;
			console.log("vm.json: ", vm.json);
		}
	});		
}

		
	 
</script>
</html>