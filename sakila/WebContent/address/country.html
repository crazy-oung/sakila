<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sakila : êµ­ê°€ ê´€ë¦¬</title>
<!-- ìŠ¤íƒ€ì¼ì‹œíŠ¸ css íŒŒì¼ import -->
<link rel="stylesheet" href="../style/hi.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>
<body>
	<div class="columns" style="margin:0; height: 100%">
	<!-- {{x}} -->
		<!-- ë©”ë‰´ -->
		<div class="column is-2 notification card is-peachy" style="margin:0;">
			<section class="section">
			    <div id="menu"></div>
			</section>
		</div>
		<!-- ë‚´ìš© -->
		<div class="column">
			 <nav class="breadcrumb notification is-lighter-peachy" aria-label="breadcrumbs">
			  <ul>
			    <li><a href="#">ADDRESS</a></li>
			    <li class="is-active"><a href="#" aria-current="page">êµ­ê°€ê´€ë¦¬</a></li>
			  </ul>
			 </nav>
			 
			<section class="is-content">
		   	 	<h1 class="title is-4 is-spaced">ğŸŒ êµ­ê°€ ê´€ë¦¬</h1>
				<h1 class="subtitle is-6">êµ­ê°€ ì„ íƒì§€ ì¶”ê°€</h1>
				<hr>
				<div class="columns">
					<div class="column">
						êµ­ê°€ëª… <input class="input" v-model="countryName" type="text">
					</div>
					<div class="column">
						<br><button class="button is-light is-danger is-rounded" type="button" @click="addCountry">êµ­ê°€ì¶”ê°€</button>
					</div>
				</div>
				<hr>
				<h2 class="title is-5 has-text-centered">êµ­ê°€ ëª©ë¡ ì¡°íšŒ</h2>
				<!-- {{json}} -->
				<table class="table is-hoverable is-fullwidth is-bordered">
					<thead>
						<tr>
							<th>ë“±ë¡ë²ˆí˜¸</th>
							<th>êµ­ê°€ëª…</th>
							<th>ë§ˆì§€ë§‰ ìˆ˜ì •</th>
						</tr>
					</thead>
					<tbody id="list">
						<tr v-for="jsons in json">
							<td>{{ jsons.countryId }}</td>
							<td>{{ jsons.country }}</td>
							<td>{{ jsons.lastUpdate }}</td>
						</tr>
					</tbody>
				</table>
				<button type="button" class="button" @click="prevBtn">ì´ì „</button>
				<button type="button" class="button" @click="nextBtn">ë‹¤ìŒ</button>
			</section>
			<div id="foot"></div>
		</div>
	</div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="../js/sakilaCRM.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
var currentPage = 1;
var lastPage;

var vm = new Vue({
	el: ".columns",
	data: {
		x:1,
		json:[{}],
		countryName : "",
	},
	mounted() {
		console.log("getting Info! ");
		getCountryList();
	},
	methods: {
		addCountry : function(){
			//insert ë²„íŠ¼ í´ë¦­ì‹œ ì‹¤í–‰
			// ë²„íŠ¼ í´ë¦­ì‹œ í´ë¦­ í•¨ìˆ˜ê°€ ì‹¤í–‰ëœë‹¤.
			console.log("country Value: ", this.countryName);
			if(this.countryName === ""){
				alert("êµ­ê°€ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
				return;
			}
			
			$.ajax({	
				url : "/sakila/address/InsertCountry",
				method: "POST",
				data: {country: this.countryName },
				async : false,
				success : function(){
					console.log("succeed!");
				},
			});
			
			// ì¶”ê°€ í›„ í˜ì´ì§€ ìˆ˜ ê°±ì‹ 
			$.ajax({
				url : "/sakila/addrerss/selectCountryCount",
				method : "POST",
				success : function(json){
					console.log(json);
					let count = Number(json);
					lastPage = Math.ceil(count / 10);
					console.log(lastPage);
					
					// ê°±ì‹  í›„ ì¶œë ¥
					getCountryList();
				}
			});
		},
		
		nextBtn : function(){
			this.x = 10;
			if(currentPage >= lastPage){
				alert("ë§ˆì§€ë§‰ í˜ì´ì§€ì…ë‹ˆë‹¤.")
				return;
			}
			
			currentPage ++;
			getCountryList();
		},
		prevBtn : function(){
			if(currentPage <= 1){
				alert("ì´ì „ í˜ì´ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.")
				return;
			}
			
			currentPage --;
			getCountryList();
		},
	},
});

function getCountryList(){
	console.log("get CountryList")
	$.ajax({
		url: "/sakila/address/SelectCountryList",
		method: "POST",
		data : { currentPage : currentPage},
		success : function(json){
			console.log(json);
			vm.json = json;	
			console.log("vm.json",vm.json);
		}
	});		
}

	/* $("#list").empty();
	// ì²˜ìŒ í˜ì´ì§€ ì—´ì—ˆì„ ë•Œ ëª©ë¡ ì¶œë ¥
			
	
	//ì´ì „ ë²„íŠ¼
	$("#preBtn").click(function(){
		if(currentPage === 1){
			alert(" í˜„ì¬ 1í˜ì´ì§€ ì…ë‹ˆë‹¤. ë” ì´ìƒ ì•ìœ¼ë¡œ ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
			return;
		}
		currentPage -=1;
		console.log(currentPage);
		
		$("#list").empty();
		// ëª©ë¡ ì¶œë ¥
		$.ajax({
			url: "/sakila/address/SelectCountryList",
			method: "POST",
			data : { currentPage : currentPage},
			success : function(json){
				console.log(json);
				for(let i =0; i < json.length; i++){
				let html = "<tr>";
				html += "<td>"+json[i].countryId+"</td>";
				html += "<td>"+json[i].country+"</td>";
				html += "<td>"+json[i].lastUpdate+"</td>";
				html += "</tr>";
				$("#list").append(html);     
				}
										
			}
		});		
	});
	
	// ë‹¤ìŒ ë²„íŠ¼
	$("#nextBtn").click(function(){
		let count = 0;
		
		
		let 
		if(currentPage == lastPage){
			alert(" í˜„ì¬ ë§ˆì§€ë§‰í˜ì´ì§€ ì…ë‹ˆë‹¤. ë” ì´ìƒ ë‹¤ìŒìœ¼ë¡œ ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
			return;
		}
		
		currentPage +=1;
		console.log(currentPage);
		
		$("#list").empty();
		// ëª©ë¡ ì¶œë ¥
		$.ajax({
			url: "/sakila/address/SelectCountryList",
			method: "POST",
			data : { currentPage : currentPage},
			success : function(json){
				console.log(json);
				for(let i =0; i < json.length; i++){
				let html = "<tr>";
				html += "<td>"+json[i].countryId+"</td>";
				html += "<td>"+json[i].country+"</td>";
				html += "<td>"+json[i].lastUpdate+"</td>";
				html += "</tr>";
				$("#list").append(html);
				}
										
			}
		});		
	});
	 */
	
	
</script>
</html>