<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sakila : ê³ ê° ê´€ë¦¬</title>
<!-- ìŠ¤íƒ€ì¼ì‹œíŠ¸ css íŒŒì¼ import -->
<link rel="stylesheet" href="../style/hi.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>
<body>
<div class="columns" style="margin:0; height: 100%">
		<!-- ë©”ë‰´ -->
		<div class="column is-2 notification card is-peachy" style="margin:0;">
			<section class="section">
			    <div id="menu"></div>
			</section>
		</div>
		<!-- ë‚´ìš© -->
		<div class="column">
			 <nav class="breadcrumb notification is-lighter-peachy" aria-label="breadcrumbs">
			  <ul>
			    <li><a href="#">CUSTOMER</a></li>
			    <li class="is-active"><a href="#" aria-current="page">ê³ ê°ê´€ë¦¬</a></li>
			  </ul>
			 </nav>
			 
			<section class="is-content">
	   	 	<h1 class="title is-4 is-spaced">ğŸ‘¥ ê³ ê° ê´€ë¦¬</h1>
			<h2>ê³ ê° ì •ë³´ ê¸°ì…</h2>
			<hr>
			<input class="input" type="text" id="countryId" style="display:none">
			<input class="input"type="text" id="cityId" style="display:none">
			<div class="columns">
 				<div class="column">
 					<!-- êµ­ê°€ ì„ íƒ -->
					êµ­ê°€<br>
					<div class="select">
						<select id="countryList"></select>
					</div><br><hr>
					ì£¼ì†Œ <br><input class="input"type="text" id="address" ><hr>
					ì§€êµ¬ <br><input class="input"type="text" id="district" ><hr>
					ìš°í¸ë²ˆí˜¸ <br><input class="input"type="text" id="postalCode" ><hr>
					ì„± <br><input class="input" type="text" id="lastName" ><hr>
					ì´ë©”ì¼ <br><input class="input" type="text" id="email" >		
 				</div>
 				<div class="column">
					<!-- ë„ì‹œ ì„ íƒ -->
					ë„ì‹œ<br>
					<div class="select" id="citys">
						<select id="cityList"></select>
					</div><br><hr>
					ìƒì„¸ì£¼ì†Œ <br><input class="input"type="text" id="address2" ><hr>
					ë²ˆí˜¸ <br><input class="input"type="text" id="phone" ><hr>
					ì§€ì <br>
					<div class="select">
						<select id="storeId">
							<option value="1">1</option>
							<option value="2">2</option>
						</select>
					</div><hr>
					ì´ë¦„ <br><input class="input" type="text" id="firstName" ><hr>
					<br>
					<button type="button" class="button is-danger is-light is-fullwidth is-rounded" id="addCustomer"> íšŒì›ë“±ë¡ </button>
 				</div>
 			</div>
			

		
		<hr>
		<h2 class="title is-5 has-text-centered">ê³ ê° ì¡°íšŒ</h2>
		<table class="table-hover is-hoverable is-fullwidth table is-bordered">
			<thead>
			<tr>
				<th class="has-text-centered">ë²ˆí˜¸</th>
				<th class="has-text-centered">ì´ë¦„</th>
				<th class="has-text-centered">ì„±</th>
				<th class="has-text-centered">ì§€ì </th>
				<th class="has-text-centered">í™œë™</th>
				<th class="has-text-centered">ì´ë©”ì¼</th>
				<th class="has-text-centered">ìƒì„±ì¼</th>
				<th class="has-text-centered">ë§ˆì§€ë§‰ ìˆ˜ì •</th>
				<th class="has-text-centered">ì£¼ì†Œë²ˆí˜¸</th>
			</tr>
			</thead>
			<tbody id="list">
			</tbody>
		</table>
		<button type="button" class="button" id="preBtn">ì´ì „</button>
		<button type="button" class="button" id="nextBtn">ë‹¤ìŒ</button>
		</section>
		<div id="foot"></div>
	</div>
</div>

</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="../js/sakilaCRM.js"></script>
<script>
	let currentPage = 1;	
	
	// country ëª©ë¡ ì¶œë ¥
	$.ajax({
		url:"/sakila/address/SelectCountryListAll", 
		method: "POST",
		success : function(json){
				$(json).each(function(index, item){
				temp="<option value='";
				temp+=item.countryId;
				temp+="'>";
				temp+=item.country;
				temp+="</option>";
				$("#countryList").append(temp);
			});
		}
	});	
	// ë‚˜ë¼ ì„ íƒì‹œ ë‚˜ë¼ ë²ˆí˜¸ ì¶œë ¥ & city list select
	$("#countryList").change(function(){
		$("#countryId").val($("#countryList").val());	// countryIdê°’ì´ ìˆì„ ì¥ì†Œì— countryListì˜ ê°’ì„ ë„£ëŠ”ë‹¤.
		$("#cityList").empty();
		// when country selected -> ë„ì‹œ ëª©ë¡ ì¶œë ¥
		$.ajax({
			url:"/sakila/address/SelectCityListByCountry", 
			method: "POST",
			data : {"countryId" : $("#countryList").val()},
			success : function(json){
				$(json).each(function(index, item){
					temp="<option value='";
					temp+=item.cityId;
					temp+="'>";
					temp+=item.city;
					temp+="</option>";
					$("#cityList").append(temp);
				});
			}
		});
	});
	
	// ë„ì‹œ ì„ íƒì‹œ ë„ì‹œ ë²ˆí˜¸ ì¶œë ¥ 
	$("#cityList").change(function(){
		$("#cityId").val($("#cityList").val());
	});

	// ì²˜ìŒ í˜ì´ì§€ ì—´ì—ˆì„ ë•Œ customer ëª©ë¡ ì¶œë ¥
	$.ajax({
		url: "/sakila/customer/SelectCustomerList",
		method: "POST",
		data : { currentPage : currentPage},
		success : function(json){
			console.log(json);
			$(json).each(function(index, item){
				let html = "<tr>";
				html += "<td>"+item.customerId+"</td>";
				html += "<td>"+item.firstName+"</td>";
				html += "<td>"+item.lastName+"</td>";
				html += "<td>"+item.storeId+"</td>";
				html += "<td>"+item.active+"</td>";
				html += "<td>"+item.email+"</td>";
				html += "<td>"+item.createDate+"</td>";
				html += "<td>"+item.lastUpdate+"</td>";
				html += "<td>"+item.addressId+"</td>";
				html += "</tr>";
				$("#list").append(html);
			})					
		}, 
		error : function(){
			alert("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
		}
	});			
	
	//ì´ì „ ë²„íŠ¼
	$("#preBtn").click(function(){
		if(currentPage === 1){
			alert(" í˜„ì¬ 1í˜ì´ì§€ ì…ë‹ˆë‹¤. ë” ì´ìƒ ì•ìœ¼ë¡œ ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
			return;
		}
		currentPage -=1;
		console.log(currentPage);
		
		$("#list").empty();
		// ëª©ë¡ ì¶œë ¥
		$.ajax({
			url: "/sakila/customer/SelectCustomerList",
			method: "POST",
			data : { currentPage : currentPage},
			success : function(json){
				console.log(json);
				$(json).each(function(index, item){
					let html = "<tr>";
					html += "<td>"+item.customerId+"</td>";
					html += "<td>"+item.firstName+"</td>";
					html += "<td>"+item.lastName+"</td>";
					html += "<td>"+item.storeId+"</td>";
					html += "<td>"+item.active+"</td>";
					html += "<td>"+item.email+"</td>";
					html += "<td>"+item.createDate+"</td>";
					html += "<td>"+item.lastUpdate+"</td>";
					html += "<td>"+item.addressId+"</td>";
					html += "</tr>";
					$("#list").append(html);
				})					
			}
		});		
	});
	
	// ë‹¤ìŒ ë²„íŠ¼
	$("#nextBtn").click(function(){
		let count = 0;
		$.ajax({
			url : "/sakila/address/SelectAddressCount",
			method : "POST",
			async : false,
			success : function(json){
				console.log(json);
				count = Number(json);
			}
		});
		
		let lastPage = Math.ceil(count / 10);
		if(currentPage == lastPage){
			alert(" í˜„ì¬ ë§ˆì§€ë§‰í˜ì´ì§€ ì…ë‹ˆë‹¤. ë” ì´ìƒ ë‹¤ìŒìœ¼ë¡œ ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
			return;
		}
		
		currentPage +=1;
		console.log(currentPage);
		
		$("#list").empty();
		// ëª©ë¡ ì¶œë ¥
		$.ajax({
			url: "/sakila/customer/SelectCustomerList",
			method: "POST",
			data : { currentPage : currentPage},
			success : function(json){
				console.log(json);
				$(json).each(function(index, item){
					let html = "<tr>";
					html += "<td>"+item.customerId+"</td>";
					html += "<td>"+item.firstName+"</td>";
					html += "<td>"+item.lastName+"</td>";
					html += "<td>"+item.storeId+"</td>";
					html += "<td>"+item.active+"</td>";
					html += "<td>"+item.email+"</td>";
					html += "<td>"+item.createDate+"</td>";
					html += "<td>"+item.lastUpdate+"</td>";
					html += "<td>"+item.addressId+"</td>";
					html += "</tr>";
					$("#list").append(html);
				})					
			}
		});		
	});
	
	$("#addCustomer").click(function(){
		console.log("addCustomer ë²„íŠ¼ clicked"); 
		currentPage = 1;
		if($("#cityId").val() === ""){
			alert("ë„ì‹œë¥¼ ì§€ì •í•´ì£¼ì„¸ìš” !");
		}else{					
			$.ajax({
				url: "/sakila/customer/InsertCustomer",
				method: "POST", 
				data: {	cityId: $("#cityId").val(),
						address: $("#address").val(),
						address2: $("#address2").val(),
						district: $("#district").val(),
						postalCode: $("#postalCode").val(),
						phone: $("#phone").val(),
						storeId: $("#storeId").val(),
						firstName: $("#firstName").val(),
						lastName: $("#lastName").val(),
						email: $("#email").val()
				},
				success: function(json){
					console.log("ë ˆê³ ë ˆê³ ~");
					console.log("cityId: "+$("#cityId").val());
					//ë¹„ìš°ê³ 
					$("#list").empty();
					// ëª©ë¡ ì¶œë ¥
					getList();
				},//success end
			});	// ajax end		
		}//else end
	});//click end
	 
</script>
</html>