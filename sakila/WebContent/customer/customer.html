
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Sakila : ê³ ê° ê´€ë¦¬</title>
    <!-- ìŠ¤íƒ€ì¼ì‹œíŠ¸ css íŒŒì¼ import -->
    <link rel="stylesheet" href="../style/hi.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>

<body>
    <div class="columns" style="margin:0; height: 100%">
        <!-- ë©”ë‰´ -->
        <div class="column is-2 notification card is-peachy" style="margin:0;">
            <section class="section">
                <component v-bind:is="testCompo"></component>
            </section>
        </div>
        <!-- ë‚´ìš© -->
        <div class="column">
            <nav class="breadcrumb notification is-lighter-peachy" aria-label="breadcrumbs">
                <ul>
                    <li><a href="#">CUSTOMER</a></li>
                    <li class="is-active"><a href="#" aria-current="page">ê³ ê°ê´€ë¦¬</a></li>
                </ul>
            </nav>

            <section class="is-content">
                <h1 class="title is-4 is-spaced">ğŸ‘¥ ê³ ê° ê´€ë¦¬</h1>
                <h2>ê³ ê° ì •ë³´ ê¸°ì…</h2>
                <hr>
                <div class="columns">
                    <div class="column">
                        <!-- êµ­ê°€ ì„ íƒ -->
                        êµ­ê°€<br>
                        <div class="select">
                            <select v-model="json.countryId" @change="changeCountry">
                            	<option selected value="0"> êµ­ê°€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”. </option>
                            	<option v-for="item in country" :value="item.countryId">{{ item.country }}</option>
                            </select>
                        </div><br>
                        <hr> ì£¼ì†Œ <br><input class="input" type="text" v-model="json.address">
                        <hr> ì§€êµ¬ <br><input class="input" type="text" v-model="json.district">
                        <hr> ìš°í¸ë²ˆí˜¸ <br><input class="input" type="text" v-model="json.postalCode">
                        <hr> ì„± <br><input class="input" type="text" v-model="json.lastName">
                        <hr> ì´ë©”ì¼ <br><input class="input" type="text" v-model="json.email">
                    </div>
                    <div class="column">
                        <!-- ë„ì‹œ ì„ íƒ -->
                        ë„ì‹œ<br>
                        <div class="select">
                            <select v-model="json.cityId" @change="changeCity">
                            	<option selected value="0">ë„ì‹œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</option>
                            	<option v-for="item in city" :value="item.cityId">{{ item.city }} </option>
                            </select>
                        </div><br>
                        <hr> ìƒì„¸ì£¼ì†Œ <br><input class="input" type="text" v-model="json.address2">
                        <hr> ë²ˆí˜¸ <br><input class="input" type="text" v-model="json.phone">
                        <hr> ì§€ì  <br>
                        <div class="select">
                            <select v-model="json.storeId">
				              <option selected  value="1">1</option>
				              <option value="2">2</option>
				            </select>
                        </div>
                        <hr> ì´ë¦„ <br><input class="input" type="text" v-model="json.firstName">
                        <hr>
                        <br>
                        <button type="button" class="button is-danger is-light is-fullwidth is-rounded" @click="addCustomer"> íšŒì›ë“±ë¡ </button>
                    </div>
                </div>



                <hr>
                <h2 class="title is-5 has-text-centered">ê³ ê° ì¡°íšŒ</h2>
                <table class="table-hover is-hoverable is-fullwidth table is-bordered">
                    <thead>
                        <tr>
                            <th class="has-text-centered">ë²ˆí˜¸</th>
                            <th class="has-text-centered">ì´ë¦„</th>
                            <th class="has-text-centered">ì„±</th>
                            <th class="has-text-centered">ì§€ì </th>
                            <th class="has-text-centered">í™œë™</th>
                            <th class="has-text-centered">ì´ë©”ì¼</th>
                            <th class="has-text-centered">ìƒì„±ì¼</th>
                            <th class="has-text-centered">ë§ˆì§€ë§‰ ìˆ˜ì •</th>
                            <th class="has-text-centered">ì£¼ì†Œë²ˆí˜¸</th>
                        </tr>
                    </thead>
                    <tbody id="list">
                    	<tr v-for="item in jsons">
                    		<td>{{item.customerId}}</td>
                    		<td>{{item.firstName}}</td>
                    		<td>{{item.lastName}}</td>
                    		<td>{{item.storeId}}</td>
                    		<td>{{item.active}}</td>
                    		<td>{{item.email}}</td>
                    		<td>{{item.createDate}}</td>
                    		<td>{{item.lastUpdate}}</td>
                    		<td>{{item.addressId}}</td>
                    	</tr>
                    </tbody>
                </table>
                <button type="button" class="button" id="preBtn" v-on:click="preBtnClick">ì´ì „</button>
                <button type="button" class="button" id="nextBtn" v-on:click="nextBtnClick">ë‹¤ìŒ</button>
            </section>
            <div id="foot"></div>
        </div>
    </div>

</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="../js/sakilaCRM.js"></script>
<script>
var currentPage = 1;
var lastPage = 0;

    var vm = new Vue({
        el: '.columns',
        data: {
			country : [{}],
			countryId : 0,
			city : [{}],
			cityId : 0,
			jsons : [{}],
			json : {},
			testCompo: Menu,
        },
        mounted() {
            // country ëª©ë¡ ì¶œë ¥
            $.ajax({
                url: "/sakila/address/SelectCountryListAll",
                method: "POST",
                success: function(json) {
                    vm.country = json;
                    console.log("vm.country: ", vm.country)
                }
            });

            // ì²˜ìŒ í˜ì´ì§€ ì—´ì—ˆì„ ë•Œ customer ëª©ë¡ ì¶œë ¥
           getCustomerList();
        },
        methods: {
            // ë‚˜ë¼ ì„ íƒì‹œ ë‚˜ë¼ ë²ˆí˜¸ ì¶œë ¥ & city list select
            changeCountry: function() {
            	vm.json.countryId = this.json.countryId;
             	console.log("vm.json.countryId changed : ", this.json.countryId);
             	vm.json.cityId=0;
                $.ajax({
                    url: "/sakila/address/SelectCityListByCountry",
                    method: "POST",
                    data: {
                        "countryId": vm.json.countryId,
                    },
                    success: function(json) {
                        vm.city = json;
                        console.log("vm.city: ", vm.city);
                    }
                });
            },
            // ë„ì‹œ ì„ íƒì‹œ ë„ì‹œ ë²ˆí˜¸ ì¶œë ¥ 
            changeCity: function() {
               	vm.json,ityId = this.json.cityId;
             	console.log("vm.json.cityId changed : ", vm.json.cityId);
            },
            preBtnClick: function() {
                if (currentPage === 1) {
                    alert(" í˜„ì¬ 1í˜ì´ì§€ ì…ë‹ˆë‹¤. ë” ì´ìƒ ì•ìœ¼ë¡œ ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }
                currentPage -= 1;
                console.log(currentPage); 
                getCustomerList(); 
            },
            nextBtnClick: function() {
                
                if (currentPage == lastPage) {
                    alert(" í˜„ì¬ ë§ˆì§€ë§‰í˜ì´ì§€ ì…ë‹ˆë‹¤. ë” ì´ìƒ ë‹¤ìŒìœ¼ë¡œ ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                currentPage += 1;
                console.log(currentPage); 
                getCustomerList();
                
            },
            addCustomer: function() {
                console.log("addCustomer ë²„íŠ¼ clicked");
                currentPage = 1;
                if ($("#cityId").val() === "") {
                    alert("ë„ì‹œë¥¼ ì§€ì •í•´ì£¼ì„¸ìš” !");
                } else {
                	console.log("vm.json : ", vm.json);
                    $.ajax({
                        url: "/sakila/customer/InsertCustomer",
                        method: "POST",
                        data: {
                            cityId: vm.json.cityId,
                            address: vm.json.address,
                            address2: vm.json.address2,
                            district: vm.json.district,
                            postalCode: vm.json.postalCode,
                            phone: vm.json.phone,
                            storeId: vm.json.storeId,
                            firstName: vm.json.firstName,
                            lastName: vm.json.lastName,
                            email: vm.json.email,
                        },
                        success: function(json) { 
                        	console.log("ì…ë ¥ ì™„");
                            // ëª©ë¡ ì¶œë ¥
                            getCustomerList();
                        }, //success end
                    }); // ajax end    
                } //else end
            }
        }
    });
    
function getCustomerList(){
	let count = 0;
    $.ajax({
        url: "/sakila/address/SelectAddressCount",
        method: "POST",
        async: false,
        success: function(json) {
            console.log(json);
            count = Number(json);
        }
    });

    let lastPage = Math.ceil(count / 10);
}


function getCustomerList(){
	// ëª©ë¡ ì¶œë ¥
    $.ajax({
        url: "/sakila/customer/SelectCustomerList",
        method: "POST",
        data: {
            currentPage: currentPage
        },
        success: function(json) {
            console.log(json);
            vm.jsons = json;
            console.log("vm.jsons: ", vm.jsons);
        }
    });
}

</script>
</html>